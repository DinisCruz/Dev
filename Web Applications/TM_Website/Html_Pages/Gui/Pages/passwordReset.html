<!DOCTYPE html>
 
<html xmlns="http://www.w3.org/1999/xhtml"> 
 
<head> 
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" /> 
    <title>TeamMentor | Login</title> 
    
    <link rel="stylesheet" href="/css/ThemeForest_ReadyMade/css/reset.css"      type="text/css" media="screen" title="no title" />
    <link rel="stylesheet" href="/css/ThemeForest_ReadyMade/css/text.css"       type="text/css" media="screen" title="no title" />
    <link rel="stylesheet" href="/css/ThemeForest_ReadyMade/css/buttons.css"    type="text/css" media="screen" title="no title" />
    <link rel="stylesheet" href="/css/ThemeForest_ReadyMade/css/login.css"      type="text/css" media="screen" title="no title" />
    <link rel="stylesheet" href="/css/ThemeForest_ReadyMade/css/forms.css"      type="text/css" media="screen" title="no title" />
    
    <script src="/aspx_Pages/scriptCombiner.ashx?s=WebServices_JS" type="text/javascript"></script>

    <script type="text/javascript">

        function openLoginPage() 
        {
            document.location = "/login";                
        }

        function changePasswordResponse(result)
        {									
            if(result === false) 
            {
                $("#loginFailed").fadeIn();
                $("#errorMessage").show().find("span").html('Change password failed');
                $("#loginSubmit").html('Change Password');
            }
            else
            {	
                $("#loginSubmit").html('Password Changed OK');
                setTimeout(openLoginPage, 1000);
            }
        }

        var onSubmit = function()
            {
                $("#errorMessage").hide();
                $("#loginFailed").fadeOut();
                $("#loginSubmit").html('Changing password');
                var newPassword = $("#newPassword").attr('value');
                var passwordConfirm = $("#passwordConfirm").attr('value');
                console.log("changing password to with: " + newPassword + " : " + passwordConfirm);
                            
                if (newPassword === "" || passwordConfirm ==="")		    
                    $("#errorMessage").show().find("span").html('You must provide both values');
                else if (newPassword !== passwordConfirm)
                    $("#errorMessage").show().find("span").html('Passwords don\'t match');
                else 
                {		            
                    var userToken = $("#UserToken").val();
                    var userName  = $("#UserName").val();		            
                    TM.WebServices.WS_Users.passwordReset(userName, userToken, newPassword, changePasswordResponse);				                    
                }            
                return false; 
            };
    
        var checkForCorrectUserAndTokenValues = function() 
            {
                var path = document.location.pathname.split("/");                
                if (path.length > 3) 
                {
                    var token = path.pop();  
                    var user  = path.pop();
                    console.log("user: " + user + " token: " + token);
                    if(token != "" && user != "")
                    {                        
                        $("#UserToken").val(token);
                        $("#UserName").val(user);
                        return;
                    }                                        
                }                
                $(".login_fields").html("There was a problem with your request")
                $(".login_actions").hide();
                $(".form").height(50);	
            };
            
        $(function()
            {
                //css fixes
                $("#errorMessage").hide()
                                  .absolute()
                                  .left(100)
                                  .top(67);
                $("h1").css('background-image','/Images/HeaderImage.jpg')
                $("#SI_Logo").width(250);			
                $(".form").height(209);	
                $("#pageTitle").absolute().top(30).left(260);
                //set the click event for the login button 
                $("#loginSubmit").click(onSubmit);

            checkForCorrectUserAndTokenValues   ();

        });
    </script>
</head> 
 
<body> 

<div id="login">
    
    <div id="login_panel">		
        <img src='/Images/HeaderImage.jpg' id='SI_Logo'/>	        
        <form class="form">
            <div id="pageTitle">
                <h3>Password reset</h3>		
            </div>			
            <div class="login_fields">
                <input type="hidden" id = "UserName"/> 
                <input type="hidden" id = "UserToken"/>
                <div class="field">
                    <label for="newPassword">New Password</label>					
                    <input type="password" name="newPassword" value="" id="newPassword" tabindex="1" placeholder="******" />		
                    <div class="error" id="errorMessage"><span>...</span></div>
                </div>
                
                
                <div class="field">
                    <label for="passwordConfirm">Password (Confirm)</label>
                    <input type="password" name="passwordConfirm" value="" id="passwordConfirm" tabindex="2" placeholder="******" />			
                </div>
            </div> <!-- .login_fields -->
            
            <div class="login_actions">				
                <button id="loginSubmit" class="btn primary" tabindex="3">Change Password</button>
            </div>
            
        </form>
    </div> <!-- #login_panel -->		
</div> <!-- #login -->

</body> 
 
</html>