
<script type="text/javascript">


	TM.Events.raiseProcessBarNextValue("Loading Html page");			
	
	TM.Gui.Main.Panels.createLayout = function()
		{			
			var layoutDefaults = 				
				{												
					 	onclose_start		: function() { console.log( "onclose_start") ; TM.Gui.disablePopups = true; }
					, 	onclose_end			: function() { console.log( "emd")			 ; TM.Gui.disablePopups= false }
			//		onresize_start  : function() { myLayout.resizing = true ; TM.Gui.Main.Panels.showResizerAndToggler(); },
			//		onresize_end    : function() { myLayout.resizing = false; TM.Gui.Main.Panels.hideResizerAndToggler();  }
				};
				
//			centerLayout = "gui_Center".$().layout();				
			
			myLayout = $('#MainTMGui').layout(
				{	
						defaults	:   layoutDefaults 
					,	north		: 	{
												resizable		: false
											,	closable		: false		
											,	spacing_open	: 0	
											,	size			: 78		 								
										}
					,	center		:	{
			//									resizable		: true
												onresize		: TM.Gui.Main.Panels.onGuiResize
			//								,	minWidth		: 100			
										}
					,	east		:	{
												size			: 350							
											,	minSize			: 250
											,	maxSize			: screen.availWidth - 400
										}
					,	west		:	{
												size			: 260
											,	minSize			: 230
											,	maxSize			: screen.availWidth - 400
										}	
				});			
	
			westLayout = $('div.ui-layout-center').layout(
				{	
					defaults: layoutDefaults,
					north:  {
									paneSelector	: ".center-north" 		
								,	size			: 225
								,	minSize			: 150
								,	maxSize			: screen.availHeight - 400
								
							},
					center: {
								 	paneSelector	: ".center-center"		
								,	resizable		: true													
								,	onresize		: TM.Gui.Main.Panels.onGuiResize
							}											
				});		
							
			//CSS Fix for IE
			if ($.browser.msie)
				"gui_North".$().height(78)	
				
			cssFixesForHomePage();
		}
	
	TM.Gui.Main.Panels.setResizerAndToggler = function(resizerColor, togglerColor)
		{			
			$(".ui-layout-resizer").css('background', resizerColor);
			$(".ui-layout-toggler").css('background', togglerColor);
		}
	TM.Gui.Main.Panels.showResizerAndToggler = function()
		{
			TM.Gui.Main.Panels.setResizerAndToggler("#EEEEFF","#AAAFFF");
		}
		
	TM.Gui.Main.Panels.hideResizerAndToggler = function()
		{			
/*			if (myLayout.resizing != true && $(".ui-layout-resizer-drag").length ===0)
				setResizerAndToggler("white","white"); */
		}	
		
	var cssFixesForHomePage = function()
		{
			/* this will auto hide the resizer bars
			$(".ui-layout-resizer").mouseover(showResizerAndToggler);
			$(".ui-layout-resizer").mouseout (hideResizerAndToggler);
			$(".ui-layout-toggler").mouseover(showResizerAndToggler);
			$(".ui-layout-toggler").mouseout (hideResizerAndToggler);
			*/
			TM.Gui.Main.Panels.showResizerAndToggler();
			
			//$("#gui_Center").css({"overflow-x" :"scroll"})
			$("#gui_CenterCenter").css('overflow','hidden')
			
			//$("#gui_Center").hide();
			TM.Gui.Main.Panels.onGuiResize();
		}
		
	//due to the way the layouts sets theses clases, we have to reset these values	
	TM.Gui.Main.Panels.onGuiResize = function()
	{		
		if (TM.Gui.Dialog.isThereAnDialogOpen())
		{			
			return ;
		}
		//if (typeof(westLayout) === "undefined")
		//	return;
			
			
		// enforce center min-width

		var diff =  $("#gui_Center").width() - 300
		if (diff < 0)
		{
			myLayout.sizePane("east", $("#gui_East").width() + diff)		
			return ;
		}	
			
		"ui-layout-resizer-north".$().width('100%')	
		"center-north".$().width("100%");	
		"center-center".$().width('100%');	
	
		
		if (isDefined(TM.showFilter_cssFixes))
			TM.showFilter_cssFixes();
		
		//$(".showFiltersPanel").width(750)
		".center-north".$().css({ 'overflow-y':'hidden'});
		

		$(".SearchTextBox").width("center-north".$().width()-150)			
		
		TM.Gui.DataTable.reDraw();
	}

	TM.Gui.Main.Panels.openAllPages = function()
	{
		myLayout.open("west"); 
		westLayout.open("north"); 
	}
	
	TM.Gui.Main.Panels.onlyShowTableAndGuidanceItem = function()
	{
		myLayout.close("west"); 
		westLayout.close("north"); 
		myLayout.sizePane("east","MainTMGui".$().width() /2);
	}
	
	TM.Gui.Main.Panels.applyHomePageView = function(commands)
		{						
			jQuery.each(commands, function()
					{
						var splitCommand = this.split(":");
						if(splitCommand.length ==2)
						{
							var command = splitCommand[0];
							var value = splitCommand[1];
							switch(command)
							{
								case "showTree":
									if (value =="false")
										myLayout.close("west");
									else
										myLayout.open("west");
									break;
								case "showFilters": 
									if (value =="false")																			
										westLayout.close("north"); 
									else
										westLayout.open("north");
									break;	
								case "centerGuidanceItems":
									if (value =="false")
										myLayout.sizePane("east",350);
									else
										myLayout.sizePane("east","MainTMGui".$().width() /2);	
									break;
								case "loadLibrary":
									TM.InitialLibrary = value;																		
								default:
									//console.log("Unrecognized command ******: " + command);
									break;									
							}
						}						
					});
		}

	
		
	TM.Gui.Main.Panels.buildGui = function()
	{			
		TM.Events.raiseProcessBarNextValue("Creating User Interface");					
		TM.Gui.Main.Panels.createLayout();		
		
		if ($.browser.msie && $.browser.version == '7.0')		//wreird IE 7 bug where we need to call this twice for the layouts to be visible
			TM.Gui.Main.Panels.createLayout();		
				
		TM.Events.raiseProcessBarNextValue("Opening Default View");
		
		TM.Gui.Main.Panels.openDefaultPanes();	
		
		TM.Events.raiseProcessBarNextValue("Opening Default View");
		TM.Gui.Main.Panels.setHomePageViewFromUrlHash();		
		
		
		$('#JS_Dialog').html('');
		
		
		if (TM.Debug.gui_LoadLibraryData)
		{		
			TM.Events.onFolderStructureLoaded.add(function()
				{			
					TM.Events.raiseProcessBarNextValue("Loading Library Tree")		
					
					$("#gui_Center").show();
					TM.HomePageLoaded = "TM: HomePage Loaded";					
										
					TM.Events.onMainGuiLoaded();		
					TM.Gui.ShowProgressBar.close();
				});		
				
			TM.Events.raiseProcessBarNextValue("Downloading Data");	
			TM.Events.onFolderStructureLoaded();
		}
		else		
			TM.Gui.ShowProgressBar.close();	
	}
	
	$(function()
		{				
			TM.Events.onMainGuiDivAvailable();
			TM.Gui.Main.Panels.buildGui();		
			
		});
	
	$(window).bind('hashchange', TM.Gui.Main.Panels.setHomePageViewFromUrlHash);
	

</script>		

<div id="TopMenuLinks" class="LoggedInLinks"> </div>
<div id="MainTMGui">
	<div class="pane ui-layout-center" id="gui_Center">			
		<div class="center-north" id="gui_CenterNorth">
			<div id="gui_CenterNorth_top"/>
			<div id="gui_CenterNorth_bottom"/>
		</div>		
		<div class="center-center" id="gui_CenterCenter"></div>
	</div>
	<div class="pane ui-layout-north" id="gui_North">	<br/><br/>	</div>		
	<!--<div class="pane ui-layout-south" id="gui_South"></div>	-->
	<div class="pane ui-layout-east" id="gui_East"></div>
	
	<div class="pane ui-layout-west" id="gui_West">
		<div id="gui_West_top"/>
		<div id="gui_West_bottom"/>
		<div>
	</div>			
</div>

<div id="JS_Dialog"></div>

<style type="text/css">

	html, body {		
		overflow:	auto;   /* when page gets too small */
	}

	
	#MainTMGui {
		background	: #ffffff;
		top			: 0px;
		bottom		: 0px;		
		left		: 0px;
		right		: 0px;
		position	: absolute;		
		
		height		: 100%;
		width		: 100%;
		min-width 	: 800px;
		min-height	: 500px;
		_height		: 100%; /* min-height for IE6 */
		_width		: 100%; /* min-width for IE6 */
		
	}

	.pane {
		display:	none; /* will appear when layout inits */

	}	
	</style>	

	<style type="text/css">
	/**
	 *	Basic Layout Theme
	 * 
	 *	This theme uses the default layout class-names for all classes
	 *	Add any 'custom class-names', from options: paneClass, resizerClass, togglerClass
	 */

	.ui-layout-pane   /* all 'panes' */ 
	{ 
		background: #FFF; 
		border: 0px solid #BBB; 
		padding: 0px; 
		overflow: auto;
	} 

	.ui-layout-resizer 	 /* all 'resizer-bars' */ 
	{
		background: #EEEEFF; 		
	} 

	.ui-layout-toggler /* all 'toggler-buttons' */ 
	{ 
		background: #AAAFFF; 	
	} 
	
	.ui-layout-content 
	{
	/*	overflow:		hidden !important; */ /* prevent scrollbars auto-added by Layout */
		overflow: auto;
	}
)

	</style>