
@using O2.DotNetWrappers.ExtensionMethods
@using TeamMentor.CoreLib
@using FluentSharp

@{
    var userData = TM_UserData.Current;
    var userName   = System.Web.HttpContext.Current.Request["userName"];
    var max   = System.Web.HttpContext.Current.Request["max"].toInt();
    var tmUser = userData.tmUser(userName);

    if (max == 0)
    {
        max = 50;
    }
    var index = tmUser.UserActivities.size();
}

<h4>User details</h4>

@if (tmUser.notNull())
{
    <ul>
        <b>ID (internal): </b> @tmUser.ID <br/>
        <b>User ID: </b> @tmUser.UserID <br/>
        <b>User Email: </b> @tmUser.EMail <br/>
        <b>User Name: </b> @tmUser.UserName <br/>
        <b>Creation Date: </b> @tmUser.Stats.CreationDate <br/>
        <b>Last Login: </b> @tmUser.Stats.LastLogin <br/>
        <b>Login Ok: </b> @tmUser.Stats.LoginOk<br/>
        <b>Login Fail: </b> @tmUser.Stats.LoginFail <br/>              
    </ul>

    <h5>User Activity (top @max of @tmUser.UserActivities.size())</h5>

    <ul>
        <table class="table table-striped table-condensed">
            <tr>
                <th>#</th>
                <th>Name</th>
                <th>Details</th>
                <th>When</th>                        
            </tr> 
            @foreach (var userActivity in tmUser.UserActivities.OrderByDescending((activity)=> activity.When).take(max))
            {
                <tr>
                    <td>@(index--)</td>
                    <td>@userActivity.Name </td>
                    <td>@userActivity.Detail </td>
                    <td>@userActivity.When.fromFileTimeUtc() </td>
                </tr>
            }
        </table>
    </ul>
    
<h5>User Actions</h5>
    <ul>
        <li>  <b>Password ResetToken: </b> @tmUser.SecretData.PasswordResetToken
            <ul>
                <li><a href="/rest/passwordResetToken/@tmUser.UserName/@tmUser.EMail" target="_blank" >renew</a></li>
                <li><a href="/passwordForgot" target="_blank" >password forgot page</a></li>
                <li><a href="/passwordReset/@tmUser.UserName/@tmUser.SecretData.PasswordResetToken" target="_blank" >password reset</a> (use to change user's pwd)</li>
            </ul>
        </li>
    </ul>
    <ul>
        <li><b>SingleUse Token: </b> @tmUser.SecretData.SingleUseLoginToken  
            <ul>
                <li><a href="/rest/loginToken/@tmUser.UserName" target="_blank" >renew</a> </li>
                <li><a href="/rest/redirect/afterLoginToken/@tmUser.UserName/@tmUser.SecretData.SingleUseLoginToken">use token</a> and login as user (you will lose your current admin session)</li>
            </ul>
         </li>                                                                    
    </ul>
    
    

    @*

    
    <hr/>
    <h5>Raw Data</h5>
    <ul>
        <pre>@tmUser.toXml();</pre>
    </ul>*@
}
else
{
    <p>No user found</p>
}

<hr/>
<a href="users">back to users list</a>